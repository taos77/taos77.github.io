var m_sTool={strColor:"#00aa88",strColor2:"#666666",strColor3:"#aa8888",iLineWidth:1,iMarume:10,bDraw:!1,iStartMouseX:0,iStartMouseY:0,iLastMouseX:0,iLastMouseY:0,iStopMouseX:0,iStopMouseY:0,iStartTimer:0},m_iLoopMsec=25,m_elmCv,m_ctxCv,m_rectCv,m_iWw,m_iWh,m_engineMatter,m_bodyMatter=Matter.Body,m_bodiesMatter=Matter.Bodies,m_constraintMatter=Matter.Constraint,m_worldMatter=Matter.World,m_amtrMatter=[],m_asLine=[];
$(function(){for(var c=location.hostname,e=0,a=0;a<c.length;a++)e+=c.charCodeAt(a);805==e&&(m_iWw=$(window).width(),m_iWh=.8*$(window).height(),$("#grp").width(m_iWw),$("#grp").height(m_iWh),m_elmCv=document.getElementById("elmCv"),m_ctxCv=m_elmCv.getContext("2d"),m_rectCv=m_elmCv.getBoundingClientRect(),m_elmCv.width=m_iWw,m_elmCv.height=m_iWh,m_elmCv.addEventListener("mouseup",fnTouch,!0),m_elmCv.addEventListener("mousedown",fnTouch,!0),m_elmCv.addEventListener("mousemove",fnTouch,!0),m_elmCv.addEventListener("touchstart",
fnTouch,!0),m_elmCv.addEventListener("touchend",fnTouch,!0),m_elmCv.addEventListener("touchmove",fnTouch,!0),m_ctxCv.strokeStyle=m_sTool.strColor,m_ctxCv.lineWidth=m_sTool.iLineWidth,m_ctxCv.lineJoin="round",m_ctxCv.lineCap="round",m_engineMatter=Matter.Engine.create(document.getElementById("elm3d"),{render:{options:{wireframes:!1,width:m_iWw,height:m_iWh,background:"#FFFFFF"}}}),Matter.Engine.run(m_engineMatter),fnLoop())});
function fnTouch(c){c.preventDefault();if(1=="ontouchend"in document){var e=Math.floor(c.touches[0].clientX);var a=Math.floor(c.touches[0].clientY)}else e=c.clientX,a=c.clientY;a-=m_rectCv.top;switch(c.type){case "mousedown":case "touchstart":m_sTool.iStartTimer=(new Date).getTime();fnDrawEnd(m_sTool.iLastMouseX,m_sTool.iLastMouseY);fnDrawStart(e,a);break;case "mouseup":case "touchend":fnDrawEnd(m_sTool.iLastMouseX,m_sTool.iLastMouseY);break;case "mousemove":case "touchmove":0!=m_sTool.bDraw&&(m_sTool.iStartTimer=
(new Date).getTime(),m_ctxCv.clearRect(0,0,m_elmCv.width,m_elmCv.height),fnDrawLine(e,a))}}function fnDrawStart(c,e){1!=m_sTool.bDraw&&(m_sTool.bDraw=!0,m_sTool.iStartMouseX=c,m_sTool.iStartMouseY=e,m_sTool.iLastMouseX=c,m_sTool.iLastMouseY=e)}function fnDrawEnd(c,e){0!=m_sTool.bDraw&&(m_sTool.bDraw=!1,m_ctxCv.clearRect(0,0,m_elmCv.width,m_elmCv.height),fnCreateMatter(c,e))}
function fnLoop(){m_sTool.bDraw&&m_sTool.iStopMouseX==m_sTool.iLastMouseX&&m_sTool.iStopMouseY==m_sTool.iLastMouseY&&2E3<(new Date).getTime()-m_sTool.iStartTimer&&fnDrawEnd(m_sTool.iLastMouseX,m_sTool.iLastMouseY);m_sTool.iStopMouseX=m_sTool.iLastMouseX;m_sTool.iStopMouseY=m_sTool.iLastMouseY;0<m_amtrMatter.length&&m_bodyMatter.rotate(m_amtrMatter[0],.02);setTimeout(fnLoop,m_iLoopMsec)}
function fnGetLine(c,e,a,d){var h=[];iX0=m_sTool.iStartMouseX;iY0=m_sTool.iStartMouseY;iX1=a;iY1=d;d=Math.ceil(c/36);d=Math.max(d,2);d=Math.min(d,10);a=180/d;d=e*(1-1/d*1.8);for(var g=0;360>g;g+=a){var b=iX0+Math.cos(Math.PI/180*(g+c))*e,f=iY0+Math.sin(Math.PI/180*(g+c))*e;h[h.length]={x:Math.floor(b),y:Math.floor(f)};b=iX0+Math.cos(Math.PI/180*(g+a/2+c))*d;f=iY0+Math.sin(Math.PI/180*(g+a/2+c))*d;h[h.length]={x:Math.floor(b),y:Math.floor(f)}}return h}
function fnDrawLine(c,e){var a=(Math.atan2(e-m_sTool.iStartMouseY,c-m_sTool.iStartMouseX)/(Math.PI/180)+450)%360,d=Math.sqrt(Math.pow(m_sTool.iStartMouseX-c,2)+Math.pow(m_sTool.iStartMouseY-e,2)),h=m_sTool.iStartMouseX,g=m_sTool.iStartMouseY,b=fnGetLine(a,d,h,g);if(340<a)m_ctxCv.beginPath(),m_ctxCv.arc(h,g,d,0,2*Math.PI,!0),m_ctxCv.stroke();else if(4<b.length&&b[0].x!=b[1].x){m_ctxCv.beginPath();for(a=0;a<b.length;a++)0==a?m_ctxCv.moveTo(b[a].x,b[a].y):m_ctxCv.lineTo(b[a].x,b[a].y);m_ctxCv.closePath();
m_ctxCv.stroke()}m_sTool.iLastMouseX=c;m_sTool.iLastMouseY=e}
function fnCreateMatter(c,e){var a=(Math.atan2(e-m_sTool.iStartMouseY,c-m_sTool.iStartMouseX)/(Math.PI/180)+450)%360,d=Math.sqrt(Math.pow(m_sTool.iStartMouseX-c,2)+Math.pow(m_sTool.iStartMouseY-e,2)),h=m_sTool.iStartMouseX,g=m_sTool.iStartMouseY;if(340<a)m_worldMatter.add(m_engineMatter.world,m_bodiesMatter.circle(h,g,d,{render:{fillStyle:m_sTool.strColor3,strokeStyle:m_sTool.strColor3,lineWidth:1}}));else{var b=fnGetLine(a,d,h,g);if(4<b.length&&b[0].x!=b[1].x){a=b[0].x;d=b[0].y;h=b[0].x;g=b[0].y;
for(var f=0,k=b.length;f<k;f++)a=Math.min(a,b[f].x),d=Math.min(d,b[f].y),h=Math.max(h,b[f].x),g=Math.max(g,b[f].y);f=[];k=0;for(var l=b.length;k<l;k++)f[k]={x:Math.floor(b[k].x-a),y:Math.floor(b[k].y-d)};b=Matter.Vertices.create(f);f=m_amtrMatter.length;m_amtrMatter[f]=m_bodiesMatter.fromVertices(Math.floor(a+.5*(h-a)),Math.floor(d+.5*(g-d)),b,{render:{fillStyle:0==f?m_sTool.strColor2:m_sTool.strColor,strokeStyle:0==f?m_sTool.strColor2:m_sTool.strColor,lineWidth:1}},!0);cstTemp=m_constraintMatter.create({pointA:{x:m_sTool.iStartMouseX,
y:m_sTool.iStartMouseY},bodyB:m_amtrMatter[f],length:0});m_worldMatter.add(m_engineMatter.world,[m_amtrMatter[f],cstTemp])}}};