var m_iMode,m_strMain,m_astrFull,m_strResult="";$(function(){fnInit()});var m_iLoopMsec=50,m_iAnimePer=0;
function fnInit(){function w(){m_iMode=0;m_strMain="";m_astrFull=[]}function n(){$(".subscreen").text(m_astrFull.join(" "));$(".mainscreen").text(m_strMain);$(".calc .btn").attr("disabled",!0);-1==m_iMode?$(".acx").attr("disabled",!1):0==m_iMode||2==m_iMode?($(".num").attr("disabled",!1),$(".acx").attr("disabled",!1)):1==m_iMode?($(".num").attr("disabled",!1),$(".kgo").attr("disabled",!1),$(".acx").attr("disabled",!1)):3==m_iMode?($(".num").attr("disabled",!1),$(".eql").attr("disabled",!1),$(".acx").attr("disabled",
!1)):5==m_iMode&&($(".num").attr("disabled",!1),$(".kgo").attr("disabled",!1),$(".acx").attr("disabled",!1))}function x(b){if(0!=m_iMode&&1!=m_iMode&&2!=m_iMode&&3!=m_iMode&&5!=m_iMode)return!1;5==m_iMode&&w();if(0==m_iMode||2==m_iMode)m_strMain="",m_iMode++;m_strMain+=b;n()}function v(b){if(1!=m_iMode&&5!=m_iMode)return!1;5==m_iMode&&(m_strMain=m_astrFull[4],m_astrFull=[],m_iMode=1);m_astrFull[0]=Number(m_strMain);m_astrFull[1]=b;m_strMain="";m_iMode++;n(b)}function D(){if(3!=m_iMode)return!1;m_astrFull[2]=
Number(m_strMain);if("\u00f7"==m_astrFull[1]&&0==Number(m_astrFull[2]))return m_strMain="Error",m_astrFull[3]="\uff1d",m_astrFull[4]=m_strMain,m_iMode=-1,n(),!1;var b=!1;"\uff0b"==m_astrFull[1]?m_strResult=m_astrFull[0]+m_astrFull[2]:"\uff0d"==m_astrFull[1]?m_strResult=m_astrFull[0]-m_astrFull[2]:"\u00d7"==m_astrFull[1]?m_strResult=m_astrFull[0]*m_astrFull[2]:"\u00f7"==m_astrFull[1]&&(m_strResult=Math.round(m_astrFull[0]/m_astrFull[2]),b=0<m_astrFull[0]%m_astrFull[2]);if(0>m_strResult)return m_strMain=
"\u4e73\u9996\u304c\u30de\u30a4\u30ca\u30b9\u306b\u306a\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093",m_astrFull[3]="\uff1d",m_astrFull[4]="Error",m_iMode=-1,n(),!1;if(1E4<m_astrFull[0]||1E4<m_astrFull[2]||1E4<m_strResult)return m_strMain="\u4e73\u9996\u304c\u591a\u3059\u304e\u307e\u3059",m_astrFull[3]="\uff1d",m_astrFull[4]="Error",m_iMode=-1,n(),!1;if(b)return m_strMain="\u5272\u308a\u5207\u308c\u306a\u3044\u4e73\u9996\u306f\u8a08\u7b97\u3067\u304d\u307e\u305b\u3093",m_astrFull[3]="\uff1d",
m_astrFull[4]="Error",m_iMode=-1,n(),!1;m_strMain="";m_astrFull[3]=b?"\u2252":"\uff1d";m_iMode=4;n();if("\u00d7"==m_astrFull[1]&&0==m_astrFull[0]&&0==m_astrFull[2])return m_strMain=m_strResult,m_astrFull[4]=Number(m_strMain),m_iMode=5,n(),!1;F()}function F(){function b(){m_iAnimePer+=.02;1<=m_iAnimePer&&(m_iAnimePer=1);var a=m_iAnimePer;"\uff0b"==d?(a=Math.sin(a/2*Math.PI),k[1].position.y=(1-a)*(0-q)):"\uff0d"==d?(a=1-Math.sin((a/2+.5)*Math.PI),k[1].position.y=a*(0-q)):"\u00d7"==d?(a=Math.sin(a/2*
Math.PI),k[1].position.y=(1-a)*(0-q),k[2].position.y=(1-(2*a-1))*(0-q)):"\u00f7"==d&&(a=1-Math.sin((a/2+.5)*Math.PI),k[1].position.y=a*(0-q),.5<a&&(k[2].position.y=(2*a-1)*(0-q)));B.render(y,C);1<=m_iAnimePer?setTimeout(v,2E3):setTimeout(b,m_iLoopMsec)}function v(){for(var a=0;a<iLayerCnt;a++)y.remove(k[a]),r[a].dispose(),z[a].dispose(),delete k[a];r.length=0;z.length=0;k.length=0;m_strMain=m_strResult;m_astrFull[4]=Number(m_strMain);m_iMode=5;n()}var l=m_astrFull[0],u=m_astrFull[2],d=m_astrFull[1],
p=0,f=0,g=0;"\uff0b"==d?(p=l+u,f=Math.ceil(Math.sqrt(p)),g=Math.ceil(p/f),iLayerCnt=2):"\uff0d"==d?(p=l,f=Math.ceil(Math.sqrt(p)),g=Math.ceil(p/f),iLayerCnt=2):"\u00d7"==d?(p=l*u,f=u,g=l,iLayerCnt=3):"\u00f7"==d&&(p=l,f=u,g=l/u,iLayerCnt=3);for(var e=Math.min(A/f,q/g),w=[15632571,15632571,15632571],r=[],z=[],a=0;a<iLayerCnt;a++)r[a]=new THREE.Geometry;var k=[];if(8>=e||2E3<=f*g){for(var h=0,m=0;m<g;m++)for(var c=0;c<f&&!(h>=p);c++)a=null,"\uff0b"==d?a=h<l?0:1:"\uff0d"==d?a=h<l-u?0:1:"\u00d7"==d?a=
0==c?0:1==c%2?1:2:"\u00f7"==d&&(a=0==c?0:1==c%2?1:2),r[a].vertices.push(new THREE.Vector3((c-(f-1)/2)*e,-((m-(g-1)/2)*e),0)),h++;for(a=0;a<iLayerCnt;a++)z[a]=new THREE.PointsMaterial({size:.45*e,color:w[a]}),k[a]=new THREE.Points(r[a],z[a]),y.add(k[a])}else{if(16>=e||1E3<=f*g){var t=new THREE.CircleGeometry(.3*e,8);t=new THREE.Mesh(t);for(m=h=0;m<g;m++)for(c=0;c<f&&!(h>=p);c++)t.position.set((c-(f-1)/2)*e,-((m-(g-1)/2)*e),0),a=null,"\uff0b"==d?a=h<l?0:1:"\uff0d"==d?a=h<l-u?0:1:"\u00d7"==d?a=0==c?
0:1==c%2?1:2:"\u00f7"==d&&(a=0==c?0:1==c%2?1:2),r[a].mergeMesh(t),h++}else{t=new THREE.SphereGeometry(.3*e,.3*e,.3*e);a=new THREE.SphereGeometry(.1*e,.1*e,.1*e);t=new THREE.Mesh(t);var x=new THREE.Mesh(a);for(m=h=0;m<g;m++)for(c=0;c<f&&!(h>=p);c++)t.position.set((c-(f-1)/2)*e,-((m-(g-1)/2)*e),0),x.position.set((c-(f-1)/2)*e,-((m-(g-1)/2)*e),e),a=null,"\uff0b"==d?a=h<l?0:1:"\uff0d"==d?a=h<l-u?0:1:"\u00d7"==d?a=0==c?0:1==c%2?1:2:"\u00f7"==d&&(a=0==c?0:1==c%2?1:2),r[a].mergeMesh(t),r[a].mergeMesh(x),
h++}for(a=0;a<iLayerCnt;a++)z[a]=new THREE.MeshToonMaterial({color:w[a]}),k[a]=new THREE.Mesh(r[a],z[a]),y.add(k[a])}setTimeout(function(){m_iAnimePer=0;b()},500)}$(".acx").click(function(){if(-1==m_iMode||0==m_iMode||1==m_iMode||2==m_iMode||3==m_iMode||5==m_iMode)w(),n()});$(".num").click(function(){x($(this).text())});$(".kgo").click(function(){v($(this).text())});$(".eql").click(function(){D()});$(window).keydown(function(b){if(13==b.keyCode)return!1});$(window).keyup(function(b){13==b.keyCode?
D():107==b.keyCode||187==b.keyCode?v("\uff0b"):109==b.keyCode||189==b.keyCode?v("\uff0d"):106==b.keyCode||186==b.keyCode?v("\u00d7"):111==b.keyCode||191==b.keyCode?v("\u00f7"):96<=b.keyCode&&105>=b.keyCode?x(b.keyCode-96):48<=b.keyCode&&57>=b.keyCode&&x(b.keyCode-48);return!1});w();n();var A=$(".panel").width(),q=A/2,B=new THREE.WebGLRenderer({canvas:document.querySelector("#elmCv")});B.setPixelRatio(window.devicePixelRatio);B.setSize(A,q);var y=new THREE.Scene,C=new THREE.OrthographicCamera(A/-2,
A/2,q/2,q/-2,1,1E4);C.position.set(0,0,1E3);var E=new THREE.DirectionalLight(16777215);E.position.set(1,1,2);y.add(E);B.render(y,C);$("#elmCv").show()};