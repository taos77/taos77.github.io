var m_sTool={strColor:"rgba(255,255,255,1)",iLineWidth:3,bDraw:!1,iLastMouseX:0,iLastMouseY:0,iStopMouseX:0,iStopMouseY:0,iStartTimer:0},m_iLoopMsec=25,m_elmCv,m_ctxCv,m_rectCv,m_iWw,m_iWh,m_elm3d,m_rend3d,m_cam3d,scene,m_iAngleY=0,m_aasLine=[],m_ageomTemp=[],m_aaasPt=[],m_aasPeni=[],m_iPeniPer=0,m_iPeniIdx=0;
$(function(){for(var a=location.hostname,c=0,b=0;b<a.length;b++)c+=a.charCodeAt(b);805==c&&(m_iWw=$(window).width(),m_iWh=.8*$(window).height(),$("#grp").width(m_iWw),$("#grp").height(m_iWh),m_elmCv=document.getElementById("elmCv"),m_ctxCv=m_elmCv.getContext("2d"),m_rectCv=m_elmCv.getBoundingClientRect(),m_elmCv.width=m_iWw,m_elmCv.height=m_iWh,m_elmCv.addEventListener("mouseup",fnTouch,!0),m_elmCv.addEventListener("mousedown",fnTouch,!0),m_elmCv.addEventListener("mousemove",fnTouch,!0),m_elmCv.addEventListener("touchstart",
fnTouch,!0),m_elmCv.addEventListener("touchend",fnTouch,!0),m_elmCv.addEventListener("touchmove",fnTouch,!0),m_ctxCv.strokeStyle=m_sTool.strColor,m_ctxCv.lineWidth=m_sTool.iLineWidth,m_ctxCv.lineJoin="round",m_ctxCv.lineCap="round",m_aasPeni=fnConvSvg2ShapeArray(["M 27.56587,1033.6891 L 29.99378,1024.259 L 32.295533,1014.3155 L 34.202505,1003.9585 L 35.446072,993.28751 L 35.757612,982.40242 L 34.868501,971.4029 L 32.510115,960.38867 L 28.41383,949.45948 L 29.207484,946.20857 L 30.93443,942.85588 L 27.836458,940.93522 L 24.54788,937.60988 L 26.388684,929.43748 L 28.904263,919.86807 L 33.119188,911.02853 L 38.685521,905.56063 L 41.23314,904.89296 L 45.987463,906.22245 L 51.564818,908.81177 L 56.176453,912.60849 L 59.20873,917.40738 L 58.296343,920.55029 L 57.38403,922.65348 L 58.87058,926.09117 L 60.63913,930.65738 L 64.22505,944.44453 L 66.596074,958.12943 L 67.881782,971.63346 L 68.211755,984.878 L 67.715575,997.78445 L 66.522824,1010.2742 L 64.763082,1022.2686 L 62.56593,1033.6891"]),
m_aasPeni=fnAdjustShapeScale(m_aasPeni),m_aasPeni=fnConvShapeXY2ShapeRA(m_aasPeni),m_elm3d=document.getElementById("elm3d"),m_elm3d.width=m_iWw,m_elm3d.height=m_iWh,m_rend3d=new THREE.WebGLRenderer({canvas:$("#elm3d")[0]}),m_rend3d.setSize(m_iWw,m_iWh),m_cam3d=new THREE.OrthographicCamera(-.5*m_iWw,.5*m_iWw,-.5*m_iWh,.5*m_iWh),m_cam3d.aspect=m_iWw/m_iWh,m_cam3d.position.set(0,0,1E3),scene=new THREE.Scene,scene.add(m_cam3d),fnLoop())});
function fnTouch(a){a.preventDefault();if(1=="ontouchend"in document){var c=Math.floor(a.touches[0].clientX);var b=Math.floor(a.touches[0].clientY)}else c=a.clientX,b=a.clientY;b-=m_rectCv.top;switch(a.type){case "mousedown":case "touchstart":m_sTool.iStartTimer=(new Date).getTime();fnDrawEnd(-.5);fnDrawStart(c,b);break;case "mouseup":case "touchend":fnDrawEnd(-.5);break;case "mousemove":case "touchmove":if(0!=m_sTool.bDraw&&(m_sTool.iStartTimer=(new Date).getTime(),!(10>Math.sqrt(Math.pow(m_sTool.iLastMouseX-
c,2)+Math.pow(m_sTool.iLastMouseY-b,2))))){m_sTool.iLastMouseX=c;m_sTool.iLastMouseY=b;a=m_aasLine.length-1;var e=m_aasLine[a].length;m_aasLine[a][e]={iX:c,iY:b};200<e&&fnDrawEnd(0)}}}function fnDrawStart(a,c){1!=m_sTool.bDraw&&(m_sTool.bDraw=!0,m_sTool.iLastMouseX=a,m_sTool.iLastMouseY=c,m_aasLine[m_aasLine.length]=[])}
function fnDrawEnd(a){if(0!=m_sTool.bDraw){m_sTool.bDraw=!1;var c=m_aasLine.length-1;if(2>m_aasLine[c].length)-1==m_iPeniPer&&(m_iPeniPer=0,m_rend3d.setClearColor(4473924)),m_aasLine.pop();else{m_rend3d.setClearColor(0);var b=fnGetXYRA(m_aasLine[c]),e=[];for(g=0;g<m_aasPeni.length;g++)e[g]=fnConvShapeRA2LineXY(m_aasPeni[g],b.iX,b.iY,b.iR,b.iA+Math.PI/180*90);m_aasLine[c].length>e[0].length?(g=m_aasLine[c].length,e[0]=fnAdjustShapePointCount(e[0],g)):m_aasLine[c].length<e[0].length&&(g=e[0].length,
m_aasLine[c]=fnAdjustShapePointCount(m_aasLine[c],g));fnIsReverse(m_aasLine[c],e[0])&&(e[0]=fnReverseShape(e[0]));for(var d in m_aasLine[c])m_aasLine[c][d].iOldX=m_aasLine[c][d].iX,m_aasLine[c][d].iOldY=m_aasLine[c][d].iY,m_aasLine[c][d].iNewX=e[0][d].iX,m_aasLine[c][d].iNewY=e[0][d].iY;for(e=1;0<=e;e--){b=[];var f=[];if(0==e)for(d=0,g=m_aasLine[c].length;d<g;d++)b[d]=m_aasLine[c][d].iOldX,f[d]=m_aasLine[c][d].iOldY;else for(d=0,g=m_aasLine[c].length;d<g;d++)b[d]=m_aasLine[c][d].iNewX,f[d]=m_aasLine[c][d].iNewY;
d=b[0];for(var h=b[0],g=0;g<b.length;g++)d=Math.min(d,b[g]),h=Math.max(h,b[g]);d+=.5*(h-d);for(g=0;g<b.length;g++)b[g]-=d;d=f[0];h=f[0];for(g=0;g<f.length;g++)d=Math.min(d,f[g]),h=Math.max(h,f[g]);d+=.5*(h-d);for(g=0;g<f.length;g++)f[g]-=d;d=0;for(g=m_aasLine[c].length;d<g;d++)m_aasLine[c][d].iNewX=b[d]+.5*m_iWw,m_aasLine[c][d].iNewY=f[d]+.5*m_iWh;sPath=clsShapeInkei.fnGetPath(b,f);sPath3d=clsShapeInkei.fnConv3d(sPath);m_aaasPt[e]=[];for(f=g=0;f<sPath3d.aiX.length;f+=4){m_aaasPt[e][g]=[];for(b=0;4>
b;b++)m_aaasPt[e][g][b]=[],m_aaasPt[e][g][b].iX=sPath3d.aiX[f+b],m_aaasPt[e][g][b].iY=sPath3d.aiY[f+b],m_aaasPt[e][g][b].iZ=sPath3d.aiZ[f+b];g++}}for(;0<scene.children.length;)scene.remove(scene.children[0]);e=new THREE.LineBasicMaterial({linewidth:1,color:16777215});g=0;for(f=m_aaasPt[0].length;g<f;g++){m_ageomTemp[g]=new THREE.Geometry;b=0;for(d=m_aaasPt[0][g].length;b<d;b++)m_ageomTemp[g].vertices.push(new THREE.Vector3(m_aaasPt[0][g][b].iX,m_aaasPt[0][g][b].iY,m_aaasPt[0][g][b].iZ));scene.add(new THREE.Line(m_ageomTemp[g],
e))}m_iPeniPer=-1;m_iPeniIdx=0;m_aasLine[c].iMorphPer=a}}}
function fnLoop(){m_sTool.bDraw&&m_sTool.iStopMouseX==m_sTool.iLastMouseX&&m_sTool.iStopMouseY==m_sTool.iLastMouseY&&1E3<(new Date).getTime()-m_sTool.iStartTimer&&fnDrawEnd(0);m_sTool.iStopMouseX=m_sTool.iLastMouseX;m_sTool.iStopMouseY=m_sTool.iLastMouseY;for(var a=0,c=m_aasLine.length;a<c;a++)2<=m_aasLine[a].length&&2>=m_aasLine[a].iMorphPer&&(m_aasLine[a].iMorphPer+=m_iLoopMsec/25*.1);m_ctxCv.clearRect(0,0,m_elmCv.width,m_elmCv.height);a=0;for(c=m_aasLine.length;a<c;a++){var b=m_aasLine[a].iMorphPer;
if(0<=b&&1>=b){var e=b;e=Math.max(0,e);e=Math.min(1,e);e=(Math.cos((1-e)*Math.PI)+1)/2;m_aasLine[a]=fnMorph(m_aasLine[a],"iX","iOldX","iNewX",e);m_aasLine[a]=fnMorph(m_aasLine[a],"iY","iOldY","iNewY",e)}1<=b&&2>=b&&(e=2-b,e=Math.max(0,e),e=Math.min(1,e),m_ctxCv.globalAlpha=e);0<=b&&2>=b&&(m_iAngleY=90);(!b||2>=b)&&fnDrawLine(m_ctxCv,m_aasLine[a]);m_ctxCv.globalAlpha=1}e=m_aasLine.length-1;if(0<=e&&(b=m_aasLine[e].iMorphPer,1<=b)){if(0<=m_iPeniPer&&1>=m_iPeniPer){e=(Math.cos((1-m_iPeniPer)*Math.PI)+
1)/2;a=m_iPeniIdx-40;c=m_iPeniIdx+40;.8<m_iPeniPer&&(a=0,c=m_aaasPt[0].length,m_iPeniPer=2,m_rend3d.setClearColor(0));b=0;for(var d=m_aaasPt[0].length;b<d;b++)if(b>=a&&b<c)for(var f=0,h=m_aaasPt[0][b].length;f<h;f++)m_ageomTemp[b].vertices[f].set(m_aaasPt[0][b][f].iX+(m_aaasPt[1][b][f].iX-m_aaasPt[0][b][f].iX)*e,m_aaasPt[0][b][f].iY+(m_aaasPt[1][b][f].iY-m_aaasPt[0][b][f].iY)*e,m_aaasPt[0][b][f].iZ+(m_aaasPt[1][b][f].iZ-m_aaasPt[0][b][f].iZ)*e),m_ageomTemp[b].verticesNeedUpdate=!0,m_ageomTemp[b].elementNeedUpdate=
!0,m_ageomTemp[b].computeFaceNormals();m_iPeniPer+=1/360}m_iPeniIdx=(m_iPeniIdx+80)%m_aaasPt[0].length;m_iAngleY=(m_iAngleY+2)%360;m_cam3d.position.x=1E3*Math.sin(m_iAngleY/180*Math.PI);m_cam3d.position.z=1E3*Math.cos(m_iAngleY/180*Math.PI);m_cam3d.lookAt(new THREE.Vector3(0,0,0));m_rend3d.render(scene,m_cam3d)}setTimeout(fnLoop,m_iLoopMsec)}var clsShapeInkei=clsShapeInkei||{};
clsShapeInkei={iEnd:0,fnGetPath:function(a,c){for(var b=a[0],e=a[0],d=0;d<a.length;d++)b=Math.min(b,a[d]),e=Math.max(e,a[d]);b+=.5*(e-b);for(d=0;d<a.length;d++)a[d]-=b;b=c[0];e=c[0];for(d=0;d<c.length;d++)b=Math.min(b,c[d]),e=Math.max(e,c[d]);b+=.5*(e-b);for(d=0;d<c.length;d++)c[d]-=b;return{aiX:a,aiY:c}},fnConv3d:function(a){return a=clsMorph.fnConvXYtoXYZofCylinder3d2(a,0,a.aiX.length-1,24)}};var clsMorph=clsMorph||{};
clsMorph.fnConvXYtoXYZofCylinder3d2=function(a,c,b,e){for(var d=[],f=[],h=[],g=[],m=0,l=Math.floor((b-c)/2),k=0;k<l;k+=3)for(iIdx2=0;4>iIdx2;iIdx2++)d[m]=0-a.aiX[c+(k+iIdx2)],f[m]=a.aiY[c+(k+iIdx2)],h[m]=0-a.aiX[b-(k+iIdx2)],g[m]=a.aiY[b-(k+iIdx2)],m++;a=[];c=[];b=[];var q=360/e;e=l=0;for(iAngle=270;630>iAngle;iAngle+=q){for(k=0;k<m;k++){var n=.5*(h[k]-d[k]),r=f[k]+.5*(g[k]-f[k]),p=.5*(g[k]-f[k]),t=Math.sqrt(Math.pow(n,2)+Math.pow(p,2));a[l]=d[k]+.5*(h[k]-d[k])+Math.sin(iAngle/180*Math.PI)*n;c[l]=
r+Math.sin(iAngle/180*Math.PI)*p;b[l]=Math.cos(iAngle/180*Math.PI)*t;l++}e++}for(k=d=0;k<=m;k+=4){for(f=0;f<e;f++)h=f*m+k,g=(f+1)%e*m+k,a[l]=a[h],c[l]=c[h],b[l]=b[h],l++,a[l]=a[h],c[l]=c[h],b[l]=b[h],l++,a[l]=a[g],c[l]=c[g],b[l]=b[g],l++,a[l]=a[g],c[l]=c[g],b[l]=b[g],l++;d++}k=0;for(e=a.length;k<e;k++)m=a[k],a[k]=b[k],b[k]=m;m=[];d=[];f=[];k=h=0;for(e=a.length;k<e;k++)m[h]=a[k],d[h]=c[k],f[h]=b[k],h++;return{aiX:m,aiY:d,aiZ:f}};
function fnDrawLine(a,c){if(2<=c.length){a.beginPath();for(var b=0,e=c.length;b<e;b++){var d=c[b].iX,f=c[b].iY;0==b?a.moveTo(d,f):a.lineTo(d,f)}a.stroke()}}
function fnAdjustShapePointCount(a,c){var b=0;for(iOldIdx=0;iOldIdx<a.length-1;iOldIdx++){var e=Math.sqrt(Math.pow(a[iOldIdx+1].iX-a[iOldIdx].iX,2)+Math.pow(a[iOldIdx+1].iY-a[iOldIdx].iY,2));b+=e}var d=b/(c-1),f=[],h=0;for(iOldIdx=b=0;iOldIdx<a.length-1;iOldIdx++){e=Math.sqrt(Math.pow(a[iOldIdx+1].iX-a[iOldIdx].iX,2)+Math.pow(a[iOldIdx+1].iY-a[iOldIdx].iY,2));b+=e;for(iIdx=h;iIdx*d<b;iIdx++){var g=(iIdx-h)*d/e;f[iIdx]={iX:a[iOldIdx].iX+(a[iOldIdx+1].iX-a[iOldIdx].iX)*g,iY:a[iOldIdx].iY+(a[iOldIdx+
1].iY-a[iOldIdx].iY)*g}}h=iIdx}f[c-1]={iX:a[a.length-1].iX,iY:a[a.length-1].iY};return f}function fnMorph(a,c,b,e,d){for(var f=0,h=a.length;f<h;f++)a[f][c]=a[f][b]+(a[f][e]-a[f][b])*d;return a}function fnGetXYRA(a){var c=0,b=0,e;for(e in a)c+=a[e].iX,b+=a[e].iY;c/=a.length;b/=a.length;var d=0;for(e in a)d+=Math.sqrt(Math.pow(a[e].iX-c,2)+Math.pow(a[e].iY-b,2));return{iX:c,iY:b,iR:d/a.length,iA:Math.atan2(b-(a[0].iY+(a[a.length-1].iY-a[0].iY)/2),c-(a[0].iX+(a[a.length-1].iX-a[0].iX)/2))}}
function fnConvSvg2ShapeArray(a){var c=[];for(iShapeIdx=0;iShapeIdx<a.length;iShapeIdx++){c[iShapeIdx]=[];strShape=a[iShapeIdx];var b=strShape.split(" "),e=0,d;for(d in b){var f=b[d].split(",");if(2==f.length){var h=Number(f[0]);f=Number(f[1]);c[iShapeIdx][e]={iX:h,iY:f};e++}}}return c}
function fnAdjustShapeScale(a){var c=0,b=0,e=0,d=0;for(iShapeIdx=0;iShapeIdx<a.length;iShapeIdx++)for(var f in a[iShapeIdx]){var h=a[iShapeIdx][f].iX,g=a[iShapeIdx][f].iY;0==f?(c=h,b=g,e=h,d=g):(c=Math.min(h,c),b=Math.min(g,b),e=Math.max(h,e),d=Math.max(g,d))}e-=c;d-=b;h=2/Math.max(e,d);for(iShapeIdx=0;iShapeIdx<a.length;iShapeIdx++)for(f in a[iShapeIdx])a[iShapeIdx][f].iX+=0-c-.5*e,a[iShapeIdx][f].iY+=0-b-.5*d,a[iShapeIdx][f].iX*=h,a[iShapeIdx][f].iY*=h;return a}
function fnConvShapeXY2ShapeRA(a){for(iShapeIdx=0;iShapeIdx<a.length;iShapeIdx++)for(var c in a[iShapeIdx])a[iShapeIdx][c].iA=Math.atan2(a[iShapeIdx][c].iY,a[iShapeIdx][c].iX),a[iShapeIdx][c].iR=Math.sqrt(Math.pow(a[iShapeIdx][c].iX,2)+Math.pow(a[iShapeIdx][c].iY,2));return a}function fnConvShapeRA2LineXY(a,c,b,e,d){var f=[],h;for(h in a){var g=Math.cos(a[h].iA+d)*a[h].iR,m=Math.sin(a[h].iA+d)*a[h].iR;g=c+g*e;m=b+m*e;f[h]={iX:g,iY:m}}return f}
function fnIsReverse(a,c){var b=a[0].iX,e=a[0].iY,d=a[a.length-1].iX,f=a[a.length-1].iY,h=c[0].iX,g=c[0].iY,m=c[c.length-1].iX,l=c[c.length-1].iY;return Math.sqrt(Math.pow(b-h,2)+Math.pow(e-g,2))+Math.sqrt(Math.pow(d-m,2)+Math.pow(f-l,2))>Math.sqrt(Math.pow(b-m,2)+Math.pow(e-l,2))+Math.sqrt(Math.pow(d-h,2)+Math.pow(f-g,2))}function fnReverseShape(a){var c=[],b=a.length,e;for(e in a){var d=b-e-1;c[e]=[];c[e].iX=a[d].iX;c[e].iY=a[d].iY}return c};